(function(){"use strict";const s=window.Vue;function K(){return window.panel}function N(){return K().api}function oe(){const o=N();return{load:({parent:n,name:e})=>o.get(`${n}/sections/${e}`)}}function se(){var t;return((t=s.getCurrentInstance())==null?void 0:t.proxy).$store}const V=s.computed;s.customRef,s.defineAsyncComponent,s.defineComponent,s.effectScope,s.getCurrentInstance,s.getCurrentScope,s.h,s.inject,s.isProxy,s.isReactive,s.isReadonly,s.isRef,s.isShallow,s.markRaw;const ie=s.nextTick;s.onActivated,s.onBeforeMount;const ae=s.onBeforeUnmount;s.onBeforeUpdate,s.onDeactivated,s.onErrorCaptured,s.onMounted,s.onRenderTracked,s.onRenderTriggered,s.onScopeDispose,s.onServerPrefetch,s.onUnmounted,s.onUpdated,s.provide,s.proxyRefs,s.reactive,s.readonly;const y=s.ref;s.shallowReactive,s.shallowReadonly,s.shallowRef,s.toRaw,s.toRef,s.toRefs,s.triggerRef,s.unref,s.useAttrs,s.useCssModule,s.useCssVars,s.useListeners,s.useSlots;const G=s.watch;s.watchEffect,s.watchPostEffect,s.watchSyncEffect;const ce={blueprint:String,lock:[Boolean,Object],help:String,name:String,parent:String,timestamp:Number},le=["openai","mistral"],I=["image/png","image/jpeg","image/webp","image/gif"],ue=["error","warn","info","debug"],pe="kirby$copilot$";let U=[];const M=new Map;async function de(o){if(!Array.isArray(o))throw new TypeError("Expected an array of assets");U.length>0||(U=o)}function H(o){if(U.length===0)throw new Error("Plugin assets are not registered");const t=U.find(n=>n.filename===o);if(!t)throw new Error(`Plugin asset "${o}" not found`);return t}async function W(o){if(o.endsWith(".js")||(o+=".js"),M.has(o))return M.get(o);const n=await import(H(o).url);return M.set(o,n),n}function fe(o,t,n){return o.replace(/\{(\w+)\}/g,(e,r)=>t[r.toLowerCase()]||r)}let A;async function he(o){const t=await me(),n=await o.arrayBuffer(),e=await t.getDocument({data:n,useSystemFonts:!0}).promise;return(await Promise.all(Array.from({length:e.numPages},(c,a)=>ge(e,a+1)))).join(`
`).replace(/\s+/g," ")}async function ge(o,t){return(await(await o.getPage(t)).getTextContent()).items.filter(r=>r.str!=null).map(r=>r.str).join(" ")}async function me(){if(A)return A;A=await W("pdfjs");const o=H("pdfjs.worker.js");return A.GlobalWorkerOptions.workerSrc=o.url,A}class ye{constructor(){this.defaultColor="#7f8c8d",this.levelColorMap={0:"#c0392b",1:"#f39c12",2:"#00BCD4"},this.typeColorMap={success:"#2ecc71"}}_getLogFn(t){return t<1?console.error:console.log}log(t){const n=this._getLogFn(t.level),e=t.type==="log"?"":t.type,r=t.tag||"",a=`
  background: ${this.typeColorMap[t.type]||this.levelColorMap[t.level]||this.defaultColor};
  border-radius: 0.5em;
  color: white;
  font-weight: bold;
  padding: 2px 0.5em;
`.trimStart(),l=`%c${[r,e].filter(Boolean).join(":")}`;typeof t.args[0]=="string"?n(`${l}%c ${t.args[0]}`,a,"",...t.args.slice(1)):n(l,a,...t.args)}}const ve={error:0,warn:1,info:2};function _e(o){const t=new ye;return new Proxy({},{get(n,e){return(...r)=>{t.log({level:ve[e],type:e,tag:o,args:r})}}})}let we;function be(){return we??(we=_e("copilot"))}async function xe({userPrompt:o,systemPrompt:t,context:n,files:e,config:r,logLevel:c,abortSignal:a}){const l=be(),{createMistral:i,createOpenAI:f,experimental_streamText:h}=await W("ai"),v=r.provider,u=r.providers[v],C={mistral:i,openai:f}[v],$=C({baseUrl:u.baseUrl||void 0,apiKey:u.apiKey}),P=e.filter(w=>w.type.startsWith("image/")),k=e.filter(w=>w.type==="application/pdf");let _=fe(o,n);if(k.length>0){const g=`Additional context from the following PDF documents has been processed and made available to you. Include the information from these documents as applicable.

${(await Promise.all(k.map(he))).map((m,b)=>`PDF document ${b+1}: ${m}`).join(`

`)}`;_+=`

${g}`}if(c>1&&(l.info("System prompt:",t),l.info("User prompt with context:",_)),v==="openai"&&P.length>0){const w=await Promise.all(P.map(async g=>{const m=await g.arrayBuffer();return{data:new Uint8Array(m),mimeType:g.type}}));return h({model:$.chat(u.model),temperature:r.temperature,maxTokens:r.maxGenerationTokens,system:t,messages:[{role:"user",content:[{type:"text",text:_},...w.map(g=>({type:"image",image:g.data}))]}],abortSignal:a})}return h({model:$.chat(u.model),temperature:r.temperature,maxTokens:r.maxGenerationTokens,system:t,prompt:_,abortSignal:a})}const J=Object.freeze({ignoreUnknown:!1,respectType:!1,respectFunctionNames:!1,respectFunctionProperties:!1,unorderedObjects:!0,unorderedArrays:!1,unorderedSets:!1,excludeKeys:void 0,excludeValues:void 0,replacer:void 0});function ke(o,t){t?t={...J,...t}:t=J;const n=Y(t);return n.dispatch(o),n.toString()}const Se=Object.freeze(["prototype","__proto__","constructor"]);function Y(o){let t="",n=new Map;const e=r=>{t+=r};return{toString(){return t},getContext(){return n},dispatch(r){return o.replacer&&(r=o.replacer(r)),this[r===null?"null":typeof r](r)},object(r){if(r&&typeof r.toJSON=="function")return this.object(r.toJSON());const c=Object.prototype.toString.call(r);let a="";const l=c.length;l<10?a="unknown:["+c+"]":a=c.slice(8,l-1),a=a.toLowerCase();let i=null;if((i=n.get(r))===void 0)n.set(r,n.size);else return this.dispatch("[CIRCULAR:"+i+"]");if(typeof Buffer<"u"&&Buffer.isBuffer&&Buffer.isBuffer(r))return e("buffer:"),e(r.toString("utf8"));if(a!=="object"&&a!=="function"&&a!=="asyncfunction")this[a]?this[a](r):o.ignoreUnknown||this.unkown(r,a);else{let f=Object.keys(r);o.unorderedObjects&&(f=f.sort());let h=[];o.respectType!==!1&&!X(r)&&(h=Se),o.excludeKeys&&(f=f.filter(u=>!o.excludeKeys(u)),h=h.filter(u=>!o.excludeKeys(u))),e("object:"+(f.length+h.length)+":");const v=u=>{this.dispatch(u),e(":"),o.excludeValues||this.dispatch(r[u]),e(",")};for(const u of f)v(u);for(const u of h)v(u)}},array(r,c){if(c=c===void 0?o.unorderedArrays!==!1:c,e("array:"+r.length+":"),!c||r.length<=1){for(const i of r)this.dispatch(i);return}const a=new Map,l=r.map(i=>{const f=Y(o);f.dispatch(i);for(const[h,v]of f.getContext())a.set(h,v);return f.toString()});return n=a,l.sort(),this.array(l,!1)},date(r){return e("date:"+r.toJSON())},symbol(r){return e("symbol:"+r.toString())},unkown(r,c){if(e(c),!!r&&(e(":"),r&&typeof r.entries=="function"))return this.array(Array.from(r.entries()),!0)},error(r){return e("error:"+r.toString())},boolean(r){return e("bool:"+r)},string(r){e("string:"+r.length+":"),e(r)},function(r){e("fn:"),X(r)?this.dispatch("[native]"):this.dispatch(r.toString()),o.respectFunctionNames!==!1&&this.dispatch("function-name:"+String(r.name)),o.respectFunctionProperties&&this.object(r)},number(r){return e("number:"+r)},xml(r){return e("xml:"+r.toString())},null(){return e("Null")},undefined(){return e("Undefined")},regexp(r){return e("regex:"+r.toString())},uint8array(r){return e("uint8array:"),this.dispatch(Array.prototype.slice.call(r))},uint8clampedarray(r){return e("uint8clampedarray:"),this.dispatch(Array.prototype.slice.call(r))},int8array(r){return e("int8array:"),this.dispatch(Array.prototype.slice.call(r))},uint16array(r){return e("uint16array:"),this.dispatch(Array.prototype.slice.call(r))},int16array(r){return e("int16array:"),this.dispatch(Array.prototype.slice.call(r))},uint32array(r){return e("uint32array:"),this.dispatch(Array.prototype.slice.call(r))},int32array(r){return e("int32array:"),this.dispatch(Array.prototype.slice.call(r))},float32array(r){return e("float32array:"),this.dispatch(Array.prototype.slice.call(r))},float64array(r){return e("float64array:"),this.dispatch(Array.prototype.slice.call(r))},arraybuffer(r){return e("arraybuffer:"),this.dispatch(new Uint8Array(r))},url(r){return e("url:"+r.toString())},map(r){e("map:");const c=[...r];return this.array(c,o.unorderedSets!==!1)},set(r){e("set:");const c=[...r];return this.array(c,o.unorderedSets!==!1)},file(r){return e("file:"),this.dispatch([r.name,r.size,r.type,r.lastModfied])},blob(){if(o.ignoreUnknown)return e("[blob]");throw new Error(`Hashing Blob objects is currently not supported
Use "options.replacer" or "options.ignoreUnknown"
`)},domwindow(){return e("domwindow")},bigint(r){return e("bigint:"+r.toString())},process(){return e("process")},timer(){return e("timer")},pipe(){return e("pipe")},tcp(){return e("tcp")},udp(){return e("udp")},tty(){return e("tty")},statwatcher(){return e("statwatcher")},securecontext(){return e("securecontext")},connection(){return e("connection")},zlib(){return e("zlib")},context(){return e("context")},nodescript(){return e("nodescript")},httpparser(){return e("httpparser")},dataview(){return e("dataview")},signal(){return e("signal")},fsevent(){return e("fsevent")},tlswrap(){return e("tlswrap")}}}const q="[native code] }",Pe=q.length;function X(o){return typeof o!="function"?!1:Function.prototype.toString.call(o).slice(-Pe)===q}class R{constructor(t,n){t=this.words=t||[],this.sigBytes=n===void 0?t.length*4:n}toString(t){return(t||Be).stringify(this)}concat(t){if(this.clamp(),this.sigBytes%4)for(let n=0;n<t.sigBytes;n++){const e=t.words[n>>>2]>>>24-n%4*8&255;this.words[this.sigBytes+n>>>2]|=e<<24-(this.sigBytes+n)%4*8}else for(let n=0;n<t.sigBytes;n+=4)this.words[this.sigBytes+n>>>2]=t.words[n>>>2];return this.sigBytes+=t.sigBytes,this}clamp(){this.words[this.sigBytes>>>2]&=4294967295<<32-this.sigBytes%4*8,this.words.length=Math.ceil(this.sigBytes/4)}clone(){return new R([...this.words])}}const Be={stringify(o){const t=[];for(let n=0;n<o.sigBytes;n++){const e=o.words[n>>>2]>>>24-n%4*8&255;t.push((e>>>4).toString(16),(e&15).toString(16))}return t.join("")}},Re={stringify(o){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=[];for(let e=0;e<o.sigBytes;e+=3){const r=o.words[e>>>2]>>>24-e%4*8&255,c=o.words[e+1>>>2]>>>24-(e+1)%4*8&255,a=o.words[e+2>>>2]>>>24-(e+2)%4*8&255,l=r<<16|c<<8|a;for(let i=0;i<4&&e*8+i*6<o.sigBytes*8;i++)n.push(t.charAt(l>>>6*(3-i)&63))}return n.join("")}},Ce={parse(o){const t=o.length,n=[];for(let e=0;e<t;e++)n[e>>>2]|=(o.charCodeAt(e)&255)<<24-e%4*8;return new R(n,t)}},je={parse(o){return Ce.parse(unescape(encodeURIComponent(o)))}};class Ee{constructor(){this._data=new R,this._nDataBytes=0,this._minBufferSize=0,this.blockSize=512/32}reset(){this._data=new R,this._nDataBytes=0}_append(t){typeof t=="string"&&(t=je.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes}_doProcessBlock(t,n){}_process(t){let n,e=this._data.sigBytes/(this.blockSize*4);t?e=Math.ceil(e):e=Math.max((e|0)-this._minBufferSize,0);const r=e*this.blockSize,c=Math.min(r*4,this._data.sigBytes);if(r){for(let a=0;a<r;a+=this.blockSize)this._doProcessBlock(this._data.words,a);n=this._data.words.splice(0,r),this._data.sigBytes-=c}return new R(n,c)}}class Te extends Ee{update(t){return this._append(t),this._process(),this}finalize(t){t&&this._append(t)}}const Q=[1779033703,-1150833019,1013904242,-1521486534,1359893119,-1694144372,528734635,1541459225],$e=[1116352408,1899447441,-1245643825,-373957723,961987163,1508970993,-1841331548,-1424204075,-670586216,310598401,607225278,1426881987,1925078388,-2132889090,-1680079193,-1046744716,-459576895,-272742522,264347078,604807628,770255983,1249150122,1555081692,1996064986,-1740746414,-1473132947,-1341970488,-1084653625,-958395405,-710438585,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,-2117940946,-1838011259,-1564481375,-1474664885,-1035236496,-949202525,-778901479,-694614492,-200395387,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,-2067236844,-1933114872,-1866530822,-1538233109,-1090935817,-965641998],T=[];class Fe extends Te{constructor(){super(...arguments),this._hash=new R([...Q])}reset(){super.reset(),this._hash=new R([...Q])}_doProcessBlock(t,n){const e=this._hash.words;let r=e[0],c=e[1],a=e[2],l=e[3],i=e[4],f=e[5],h=e[6],v=e[7];for(let u=0;u<64;u++){if(u<16)T[u]=t[n+u]|0;else{const g=T[u-15],m=(g<<25|g>>>7)^(g<<14|g>>>18)^g>>>3,b=T[u-2],F=(b<<15|b>>>17)^(b<<13|b>>>19)^b>>>10;T[u]=m+T[u-7]+F+T[u-16]}const C=i&f^~i&h,$=r&c^r&a^c&a,P=(r<<30|r>>>2)^(r<<19|r>>>13)^(r<<10|r>>>22),k=(i<<26|i>>>6)^(i<<21|i>>>11)^(i<<7|i>>>25),_=v+k+C+$e[u]+T[u],w=P+$;v=h,h=f,f=i,i=l+_|0,l=a,a=c,c=r,r=_+w|0}e[0]=e[0]+r|0,e[1]=e[1]+c|0,e[2]=e[2]+a|0,e[3]=e[3]+l|0,e[4]=e[4]+i|0,e[5]=e[5]+f|0,e[6]=e[6]+h|0,e[7]=e[7]+v|0}finalize(t){super.finalize(t);const n=this._nDataBytes*8,e=this._data.sigBytes*8;return this._data.words[e>>>5]|=128<<24-e%32,this._data.words[(e+64>>>9<<4)+14]=Math.floor(n/4294967296),this._data.words[(e+64>>>9<<4)+15]=n,this._data.sigBytes=this._data.words.length*4,this._process(),this._hash}}function Ae(o){return new Fe().finalize(o).toString(Re)}function Le(o,t={}){const n=typeof o=="string"?o:ke(o,t);return Ae(n).slice(0,10)}function Ue(...o){return`${pe}${Le([...o])}`}let S;async function Ie({accept:o="*",multiple:t=!0}={}){return S=document.createElement("input"),S.type="file",S.classList.add("sr-only"),S.value=null,S.accept=o,S.multiple=t,S.click(),new Promise(n=>{S.addEventListener("change",e=>{n([...e.target.files]),S.remove()})})}async function Me(o,{maxSize:t}={}){if(!t)return o;const n=await De(o);return await Oe(n,o.type,t)}async function De(o){const t=new Image,n=URL.createObjectURL(o);return t.src=n,await new Promise((e,r)=>{t.onload=()=>{e(t)},t.onerror=()=>{URL.revokeObjectURL(n),r(new Error("Failed to load the image"))}}),URL.revokeObjectURL(n),t}async function Oe(o,t,n){const e=document.createElement("canvas"),r=e.getContext("2d");let c=1;n&&(o.width>n||o.height>n)&&(c=n/Math.max(o.width,o.height)),e.width=o.width*c,e.height=o.height*c,r.drawImage(o,0,0,e.width,e.height);const a=await new Promise(l=>{e.toBlob(l,t)});if(!a)throw new Error("Failed to convert canvas to Blob");return a}function ze(o,t,n,e,r,c,a,l){var i=typeof o=="function"?o.options:o;return t&&(i.render=t,i.staticRenderFns=n,i._compiled=!0),{exports:o,options:i}}const Z={...ce},Ke=Object.assign({inheritAttrs:!1},{__name:"Copilot",props:Z,setup(o){const t=o,n=K(),e=N(),r=se(),c=/^<(\w+)>\s*<\/\1>$/,a=y(),l=y(),i=y(),f=y(),h=y(),v=y(),u=y(),C=y(),$=y(),P=y(!1),k=y(!1),_=y(!1),w=y(),g=y(),m=y(),b=y([]),F=y([]);let j,E;const D=V(()=>r.getters["content/values"]()),ee=V(()=>!k.value&&m.value!==void 0);G(g,d=>{P.value&&h.value&&(d&&d!==i.value?localStorage.setItem(`${j}$prompt`,d):(!d||d===i.value)&&localStorage.removeItem(`${j}$prompt`))}),G(_,d=>{P.value&&h.value&&(d?localStorage.setItem(`${j}$open`,"true"):localStorage.removeItem(`${j}$open`))}),(async()=>{const{load:d}=oe(),p=await d({parent:t.parent,name:t.name});if(a.value=te(p.label)||n.t("johannschopplich.copilot.label"),l.value=p.field??void 0,i.value=p.userPrompt??void 0,f.value=p.systemPrompt||p.config.systemPrompt||void 0,h.value=p.storage,p.editable===!0&&b.value.push("edit"),p.files===!0&&b.value.push("files"),v.value=ue.indexOf(p.config.logLevel??p.logLevel),u.value=p.supported,C.value=p.config,de(p.assets),p.files==="auto"&&p.modelFile){$.value=p.modelFile;const{mime:B,url:x}=p.modelFile;I.includes(B)&&fetch(x).then(L=>L.blob()).then(L=>{F.value=[L]})}h.value&&(j=Ue(n.view.path,l.value),g.value=localStorage.getItem(`${j}$prompt`)||i.value||"",_.value=localStorage.getItem(`${j}$open`)==="true",ie(()=>{w.value&&_.value&&(w.value.open=!0)})),n.events.on("view.save",z),P.value=!0})(),ae(()=>{n.events.off("view.save",z)});function te(d){return!d||typeof d=="string"?d:d[n.translation.code]??Object.values(d)[0]}async function We(){if(!g.value){n.notification.error(n.t("johannschopplich.copilot.prompt.empty"));return}n.isLoading=!0,k.value=!0,m.value=D.value[l.value],E=new AbortController;let d="",p=Date.now(),B=C.value;try{const{textStream:x}=await xe({userPrompt:g.value,systemPrompt:f.value,context:ne(),files:F.value,config:B,logLevel:v.value,abortSignal:E.signal});for await(const L of x)if(d+=L,Array.isArray(m.value)){if(Date.now()-p<C.value.blocksUpdateThrottle)continue;p=Date.now();const re=await O(d);re.length>0&&r.dispatch("content/update",[l.value,[...m.value,...re]])}else r.dispatch("content/update",[l.value,m.value+d])}catch(x){if(E=void 0,n.isLoading=!1,k.value=!1,x instanceof Error&&x.name==="AbortError")return;if(x instanceof Error&&x.name==="ApiCallError"){console.error(x),n.notification.error(x.message);return}console.error(x),n.notification.error(n.t("johannschopplich.copilot.generator.error"));return}r.dispatch("content/update",[l.value,Array.isArray(m.value)?[...m.value,...await O(d)]:m.value+d]),E=void 0,n.isLoading=!1,k.value=!1,n.notification.success({icon:"sparkling",message:n.t("johannschopplich.copilot.generator.success")})}function Je(){E==null||E.abort()}function Ye(){r.dispatch("content/update",[l.value,m.value]),m.value=void 0}async function qe(){const d=await Ie({accept:[...I,"application/pdf"].join(",")});F.value=await Promise.all(d.map(async p=>p.type.startsWith("image/")?Me(p,{maxSize:2048}):p))}async function O(d){if(!d)return[];const{blocks:p}=await e.post("__copilot__/html2blocks",{html:d});return p.length===1&&"text"in p[0].content&&c.test(p[0].content.text)?[]:p}function ne(){const d={...D.value,title:n.view.title};return Object.fromEntries(Object.entries(d).map(([p,B])=>[p,Array.isArray(B)||typeof B=="object"&&B!==null?JSON.stringify(B):B]))}function z(){ee.value&&(m.value=void 0)}return{__sfc:!0,propsDefinition:Z,props:t,panel:n,api:e,store:r,EMPTY_HTML_TAG_RE:c,label:a,field:l,userPrompt:i,systemPrompt:f,storage:h,logLevel:v,supported:u,config:C,modelFile:$,isInitialized:P,isGenerating:k,isDetailsOpen:_,detailsElement:w,currentPrompt:g,currentFieldContent:m,allow:b,files:F,storageKey:j,abortController:E,currentContent:D,canUndo:ee,t:te,generate:We,abort:Je,undo:Ye,pickFiles:qe,htmlToBlocks:O,createContext:ne,onModelSave:z,SUPPORTED_PROVIDERS:le,SUPPORTED_VISION_MIME_TYPES:I}}});var Ne=function(){var r,c,a,l;var t=this,n=t._self._c,e=t._self._setupProxy;return e.isInitialized?n("k-section",{attrs:{label:e.label}},[!e.config.provider||!e.SUPPORTED_PROVIDERS.includes(e.config.provider)?n("k-box",{attrs:{theme:"empty"}},[n("k-text",[t._v(" Unsupported provider "),n("code",[t._v(t._s(e.config.provider))]),t._v(" in the "),n("code",[t._v("johannschopplich.copilot.provider")]),t._v(" global configuration. ")])],1):(c=(r=e.config.providers)==null?void 0:r[e.config.provider])!=null&&c.apiKey?(l=(a=e.config.providers)==null?void 0:a[e.config.provider])!=null&&l.model?e.field?e.field in e.currentContent?e.supported?!e.allow.includes("edit")&&!e.userPrompt?n("k-box",{attrs:{theme:"empty"}},[n("k-text",[t._v(" If the user prompt cannot be edited by the user, a default "),n("code",[t._v("userPrompt")]),t._v(" has to be set in the section configuration. ")])],1):n("div",{staticClass:"kai-space-y-4"},[n("k-button-group",{attrs:{layout:"collapsed"}},[n("k-button",{attrs:{icon:e.isGenerating?"loader":"sparkling",text:e.panel.t("johannschopplich.copilot.generate"),variant:"filled",size:"sm",theme:"positive",disabled:e.isGenerating},on:{click:function(i){return e.generate()}}}),e.isGenerating?n("k-button",{attrs:{icon:"cancel",text:e.panel.t("johannschopplich.copilot.stop"),variant:"filled",size:"sm",theme:"notice"},on:{click:function(i){return e.abort()}}}):t._e(),e.canUndo?n("k-button",{attrs:{icon:"undo",text:e.panel.t("johannschopplich.copilot.undo"),variant:"filled",size:"sm"},on:{click:function(i){return e.undo()}}}):t._e()],1),e.allow.length>0?n("details",{ref:"detailsElement",on:{toggle:function(i){e.isDetailsOpen=i.target.open}}},[n("summary",[t._v(" "+t._s([...e.allow.includes("edit")?[e.panel.t("johannschopplich.copilot.prompt.label")]:[],...e.allow.includes("files")?[e.panel.t("johannschopplich.copilot.context")]:[]].join(", "))+" ")]),n("div",{staticClass:"kai-mt-3"},[e.allow.includes("edit")?n("div",{staticClass:"kai-mb-2 kai-text-right"},[n("k-input",{key:e.isDetailsOpen?1:0,staticClass:"kai-mb-1",attrs:{placeholder:e.panel.t("johannschopplich.copilot.prompt.placeholder"),type:"textarea",buttons:!1,counter:!1},model:{value:e.currentPrompt,callback:function(i){e.currentPrompt=i},expression:"currentPrompt"}}),n("k-button",{directives:[{name:"show",rawName:"v-show",value:e.userPrompt&&e.currentPrompt!==e.userPrompt,expression:"userPrompt && currentPrompt !== userPrompt"}],attrs:{icon:"undo",text:"Reset",size:"xs",variant:"dimmed"},on:{click:function(i){e.currentPrompt=e.userPrompt}}})],1):t._e(),e.allow.includes("files")?n("k-button-group",{attrs:{layout:"collapsed"}},[n("k-button",{attrs:{icon:"upload",text:e.panel.t("johannschopplich.copilot.files.select"),variant:"filled",size:"sm"},on:{click:function(i){return e.pickFiles()}}}),e.files.length>0?n("k-button",{attrs:{icon:"cancel",text:e.panel.t("johannschopplich.copilot.remove"),variant:"filled",size:"sm"},on:{click:function(i){e.files=[]}}}):t._e()],1):e.modelFile?n("k-box",{attrs:{theme:"none"}},[n("k-text",[t._v(" "+t._s(e.panel.t(`johannschopplich.copilot.context.file.${e.SUPPORTED_VISION_MIME_TYPES.includes(e.modelFile.mime)?"model":"unsupported"}`))+" ")])],1):t._e()],1)]):t._e()],1):n("k-box",{attrs:{theme:"empty"}},[n("k-text",[t._v(" The "),n("code",[t._v(t._s(e.field))]),t._v(" field is not supported. Use a "),n("code",[t._v("blocks")]),t._v(", "),n("code",[t._v("text")]),t._v(", "),n("code",[t._v("textarea")]),t._v(" or "),n("code",[t._v("textarea")]),t._v(" type. ")])],1):n("k-box",{attrs:{theme:"empty"}},[n("k-text",[t._v(" The "),n("code",[t._v(t._s(e.field))]),t._v(" field does not exist in the current model. ")])],1):n("k-box",{attrs:{theme:"empty"}},[n("k-text",[t._v(" Missing "),n("code",[t._v("field")]),t._v(" property in the section configuration. It is required for the generated text. ")])],1):n("k-box",{attrs:{theme:"empty"}},[n("k-text",[t._v(" Missing "),n("code",[t._v("model")]),t._v(" property in the "),n("code",[t._v(t._s(`johannschopplich.copilot.providers.${e.config.provider}`))]),t._v(" global configuration. ")])],1):n("k-box",{attrs:{theme:"empty"}},[n("k-text",[t._v(" Missing "),n("code",[t._v("apiKey")]),t._v(" property in the "),n("code",[t._v(t._s(`johannschopplich.copilot.providers.${e.config.provider}`))]),t._v(" global configuration. ")])],1)],1):t._e()},Ve=[],Ge=ze(Ke,Ne,Ve);const He=Ge.exports;window.panel.plugin("johannschopplich/copilot",{sections:{copilot:He}})})();
