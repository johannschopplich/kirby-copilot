(function(){"use strict";const s=window.Vue;function K(){return window.panel}function N(){return K().api}function oe(){const o=N();return{load:({parent:r,name:e})=>o.get(`${r}/sections/${e}`)}}function se(){var t;return((t=s.getCurrentInstance())==null?void 0:t.proxy).$store}const V=s.computed;s.customRef,s.defineAsyncComponent,s.defineComponent,s.effectScope,s.getCurrentInstance,s.getCurrentScope,s.h,s.inject,s.isProxy,s.isReactive,s.isReadonly,s.isRef,s.isShallow,s.markRaw;const ie=s.nextTick;s.onActivated,s.onBeforeMount;const ae=s.onBeforeUnmount;s.onBeforeUpdate,s.onDeactivated,s.onErrorCaptured,s.onMounted,s.onRenderTracked,s.onRenderTriggered,s.onScopeDispose,s.onServerPrefetch,s.onUnmounted,s.onUpdated,s.provide,s.proxyRefs,s.reactive,s.readonly;const y=s.ref;s.shallowReactive,s.shallowReadonly,s.shallowRef,s.toRaw,s.toRef,s.toRefs,s.triggerRef,s.unref,s.useAttrs,s.useCssModule,s.useCssVars,s.useListeners,s.useSlots;const W=s.watch;s.watchEffect,s.watchPostEffect,s.watchSyncEffect;const ce={blueprint:String,lock:[Boolean,Object],help:String,name:String,parent:String,timestamp:Number},le=["openai","mistral"],I=["image/png","image/jpeg","image/webp","image/gif"],ue=["error","warn","info","debug"],pe="kirby$copilot$";let L=[];const M=new Map;async function de(o){if(!Array.isArray(o))throw new TypeError("Expected an array of assets");L.length>0||(L=o)}function H(o){if(L.length===0)throw new Error("Plugin assets are not registered");const t=L.find(r=>r.filename===o);if(!t)throw new Error(`Plugin asset "${o}" not found`);return t}async function O(o){if(o.endsWith(".js")||(o+=".js"),M.has(o))return M.get(o);const r=await import(H(o).url);return M.set(o,r),r}function fe(o,t,r){return o.replace(/{([\w\d]+)}/g,(e,n)=>t[n.toLowerCase()]||((typeof r=="function"?r(n):r)??n))}let A;async function he(o){const t=await ge(),r=await o.arrayBuffer(),e=await t.getDocument({data:r,useSystemFonts:!0}).promise;return(await Promise.all(Array.from({length:e.numPages},(c,a)=>me(e,a+1)))).join(`
`).replace(/\s+/g," ")}async function me(o,t){return(await(await o.getPage(t)).getTextContent()).items.filter(n=>n.str!=null).map(n=>n.str).join(" ")}async function ge(){if(A)return A;A=await O("pdfjs");const o=H("pdfjs.worker.js");return A.GlobalWorkerOptions.workerSrc=o.url,A}class ye{constructor(){this.defaultColor="#7f8c8d",this.levelColorMap={0:"#c0392b",1:"#f39c12",2:"#00BCD4"},this.typeColorMap={success:"#2ecc71"}}_getLogFn(t){return t<1?console.error:console.log}log(t){const r=this._getLogFn(t.level),e=t.type==="log"?"":t.type,n=t.tag||"",a=`
  background: ${this.typeColorMap[t.type]||this.levelColorMap[t.level]||this.defaultColor};
  border-radius: 0.5em;
  color: white;
  font-weight: bold;
  padding: 2px 0.5em;
`.trimStart(),u=`%c${[n,e].filter(Boolean).join(":")}`;typeof t.args[0]=="string"?r(`${u}%c ${t.args[0]}`,a,"",...t.args.slice(1)):r(u,a,...t.args)}}const ve={error:0,warn:1,info:2};function _e(o){const t=new ye;return new Proxy({},{get(r,e){return(...n)=>{t.log({level:ve[e],type:e,tag:o,args:n})}}})}let we;function be(){return we??(we=_e("copilot"))}async function xe({userPrompt:o,systemPrompt:t,context:r,files:e,config:n,logLevel:c,run:a}){const u=be(),{mistral:i,openai:p,streamText:h}=await O("modelfusion"),f={mistral:i,openai:p},l=n.provider,_=n.providers[l],S=f[l],$=S.Api({baseUrl:_.baseUrl||void 0,apiKey:_.apiKey}),B=e.filter(g=>g.type.startsWith("image/")),C=e.filter(g=>g.type==="application/pdf");let R=fe(o,r);if(C.length>0){const b=`Additional context from the following PDF documents has been processed and made available to you. Include the information from these documents as applicable.

${(await Promise.all(C.map(he))).map((v,k)=>`PDF document ${k+1}: ${v}`).join(`

`)}`;R+=`

${b}`}if(c>1&&(u.info("System prompt:",t),u.info("User prompt with context:",R)),l==="openai"&&B.length>0){const g=await Promise.all(B.map(async v=>{const k=await v.arrayBuffer();return{data:new Uint8Array(k),mimeType:v.type}})),b=S.ChatTextGenerator({api:$,model:n.providers.openai.model.vision,temperature:n.temperature,...n.maxGenerationTokens?{maxGenerationTokens:n.maxGenerationTokens}:{}}).withInstructionPrompt();return await h({model:b,prompt:{system:t,instruction:[{type:"text",text:R},...g.map(v=>({type:"image",image:v.data,mimeType:v.mimeType}))]},run:a})}const w=S.ChatTextGenerator({api:$,model:l==="openai"?_.model.default:_.model,temperature:n.temperature,...n.maxGenerationTokens?{maxGenerationTokens:n.maxGenerationTokens}:{}}).withInstructionPrompt();return await h({model:w,prompt:{system:t,instruction:R},run:a})}const J=Object.freeze({ignoreUnknown:!1,respectType:!1,respectFunctionNames:!1,respectFunctionProperties:!1,unorderedObjects:!0,unorderedArrays:!1,unorderedSets:!1,excludeKeys:void 0,excludeValues:void 0,replacer:void 0});function ke(o,t){t?t={...J,...t}:t=J;const r=Y(t);return r.dispatch(o),r.toString()}const Se=Object.freeze(["prototype","__proto__","constructor"]);function Y(o){let t="",r=new Map;const e=n=>{t+=n};return{toString(){return t},getContext(){return r},dispatch(n){return o.replacer&&(n=o.replacer(n)),this[n===null?"null":typeof n](n)},object(n){if(n&&typeof n.toJSON=="function")return this.object(n.toJSON());const c=Object.prototype.toString.call(n);let a="";const u=c.length;u<10?a="unknown:["+c+"]":a=c.slice(8,u-1),a=a.toLowerCase();let i=null;if((i=r.get(n))===void 0)r.set(n,r.size);else return this.dispatch("[CIRCULAR:"+i+"]");if(typeof Buffer<"u"&&Buffer.isBuffer&&Buffer.isBuffer(n))return e("buffer:"),e(n.toString("utf8"));if(a!=="object"&&a!=="function"&&a!=="asyncfunction")this[a]?this[a](n):o.ignoreUnknown||this.unkown(n,a);else{let p=Object.keys(n);o.unorderedObjects&&(p=p.sort());let h=[];o.respectType!==!1&&!q(n)&&(h=Se),o.excludeKeys&&(p=p.filter(l=>!o.excludeKeys(l)),h=h.filter(l=>!o.excludeKeys(l))),e("object:"+(p.length+h.length)+":");const f=l=>{this.dispatch(l),e(":"),o.excludeValues||this.dispatch(n[l]),e(",")};for(const l of p)f(l);for(const l of h)f(l)}},array(n,c){if(c=c===void 0?o.unorderedArrays!==!1:c,e("array:"+n.length+":"),!c||n.length<=1){for(const i of n)this.dispatch(i);return}const a=new Map,u=n.map(i=>{const p=Y(o);p.dispatch(i);for(const[h,f]of p.getContext())a.set(h,f);return p.toString()});return r=a,u.sort(),this.array(u,!1)},date(n){return e("date:"+n.toJSON())},symbol(n){return e("symbol:"+n.toString())},unkown(n,c){if(e(c),!!n&&(e(":"),n&&typeof n.entries=="function"))return this.array(Array.from(n.entries()),!0)},error(n){return e("error:"+n.toString())},boolean(n){return e("bool:"+n)},string(n){e("string:"+n.length+":"),e(n)},function(n){e("fn:"),q(n)?this.dispatch("[native]"):this.dispatch(n.toString()),o.respectFunctionNames!==!1&&this.dispatch("function-name:"+String(n.name)),o.respectFunctionProperties&&this.object(n)},number(n){return e("number:"+n)},xml(n){return e("xml:"+n.toString())},null(){return e("Null")},undefined(){return e("Undefined")},regexp(n){return e("regex:"+n.toString())},uint8array(n){return e("uint8array:"),this.dispatch(Array.prototype.slice.call(n))},uint8clampedarray(n){return e("uint8clampedarray:"),this.dispatch(Array.prototype.slice.call(n))},int8array(n){return e("int8array:"),this.dispatch(Array.prototype.slice.call(n))},uint16array(n){return e("uint16array:"),this.dispatch(Array.prototype.slice.call(n))},int16array(n){return e("int16array:"),this.dispatch(Array.prototype.slice.call(n))},uint32array(n){return e("uint32array:"),this.dispatch(Array.prototype.slice.call(n))},int32array(n){return e("int32array:"),this.dispatch(Array.prototype.slice.call(n))},float32array(n){return e("float32array:"),this.dispatch(Array.prototype.slice.call(n))},float64array(n){return e("float64array:"),this.dispatch(Array.prototype.slice.call(n))},arraybuffer(n){return e("arraybuffer:"),this.dispatch(new Uint8Array(n))},url(n){return e("url:"+n.toString())},map(n){e("map:");const c=[...n];return this.array(c,o.unorderedSets!==!1)},set(n){e("set:");const c=[...n];return this.array(c,o.unorderedSets!==!1)},file(n){return e("file:"),this.dispatch([n.name,n.size,n.type,n.lastModfied])},blob(){if(o.ignoreUnknown)return e("[blob]");throw new Error(`Hashing Blob objects is currently not supported
Use "options.replacer" or "options.ignoreUnknown"
`)},domwindow(){return e("domwindow")},bigint(n){return e("bigint:"+n.toString())},process(){return e("process")},timer(){return e("timer")},pipe(){return e("pipe")},tcp(){return e("tcp")},udp(){return e("udp")},tty(){return e("tty")},statwatcher(){return e("statwatcher")},securecontext(){return e("securecontext")},connection(){return e("connection")},zlib(){return e("zlib")},context(){return e("context")},nodescript(){return e("nodescript")},httpparser(){return e("httpparser")},dataview(){return e("dataview")},signal(){return e("signal")},fsevent(){return e("fsevent")},tlswrap(){return e("tlswrap")}}}const X="[native code] }",Pe=X.length;function q(o){return typeof o!="function"?!1:Function.prototype.toString.call(o).slice(-Pe)===X}class E{constructor(t,r){t=this.words=t||[],this.sigBytes=r===void 0?t.length*4:r}toString(t){return(t||Be).stringify(this)}concat(t){if(this.clamp(),this.sigBytes%4)for(let r=0;r<t.sigBytes;r++){const e=t.words[r>>>2]>>>24-r%4*8&255;this.words[this.sigBytes+r>>>2]|=e<<24-(this.sigBytes+r)%4*8}else for(let r=0;r<t.sigBytes;r+=4)this.words[this.sigBytes+r>>>2]=t.words[r>>>2];return this.sigBytes+=t.sigBytes,this}clamp(){this.words[this.sigBytes>>>2]&=4294967295<<32-this.sigBytes%4*8,this.words.length=Math.ceil(this.sigBytes/4)}clone(){return new E([...this.words])}}const Be={stringify(o){const t=[];for(let r=0;r<o.sigBytes;r++){const e=o.words[r>>>2]>>>24-r%4*8&255;t.push((e>>>4).toString(16),(e&15).toString(16))}return t.join("")}},Ce={stringify(o){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=[];for(let e=0;e<o.sigBytes;e+=3){const n=o.words[e>>>2]>>>24-e%4*8&255,c=o.words[e+1>>>2]>>>24-(e+1)%4*8&255,a=o.words[e+2>>>2]>>>24-(e+2)%4*8&255,u=n<<16|c<<8|a;for(let i=0;i<4&&e*8+i*6<o.sigBytes*8;i++)r.push(t.charAt(u>>>6*(3-i)&63))}return r.join("")}},Re={parse(o){const t=o.length,r=[];for(let e=0;e<t;e++)r[e>>>2]|=(o.charCodeAt(e)&255)<<24-e%4*8;return new E(r,t)}},Te={parse(o){return Re.parse(unescape(encodeURIComponent(o)))}};class $e{constructor(){this._data=new E,this._nDataBytes=0,this._minBufferSize=0,this.blockSize=512/32}reset(){this._data=new E,this._nDataBytes=0}_append(t){typeof t=="string"&&(t=Te.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes}_doProcessBlock(t,r){}_process(t){let r,e=this._data.sigBytes/(this.blockSize*4);t?e=Math.ceil(e):e=Math.max((e|0)-this._minBufferSize,0);const n=e*this.blockSize,c=Math.min(n*4,this._data.sigBytes);if(n){for(let a=0;a<n;a+=this.blockSize)this._doProcessBlock(this._data.words,a);r=this._data.words.splice(0,n),this._data.sigBytes-=c}return new E(r,c)}}class Ee extends $e{update(t){return this._append(t),this._process(),this}finalize(t){t&&this._append(t)}}const Q=[1779033703,-1150833019,1013904242,-1521486534,1359893119,-1694144372,528734635,1541459225],je=[1116352408,1899447441,-1245643825,-373957723,961987163,1508970993,-1841331548,-1424204075,-670586216,310598401,607225278,1426881987,1925078388,-2132889090,-1680079193,-1046744716,-459576895,-272742522,264347078,604807628,770255983,1249150122,1555081692,1996064986,-1740746414,-1473132947,-1341970488,-1084653625,-958395405,-710438585,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,-2117940946,-1838011259,-1564481375,-1474664885,-1035236496,-949202525,-778901479,-694614492,-200395387,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,-2067236844,-1933114872,-1866530822,-1538233109,-1090935817,-965641998],F=[];class Fe extends Ee{constructor(){super(...arguments),this._hash=new E([...Q])}reset(){super.reset(),this._hash=new E([...Q])}_doProcessBlock(t,r){const e=this._hash.words;let n=e[0],c=e[1],a=e[2],u=e[3],i=e[4],p=e[5],h=e[6],f=e[7];for(let l=0;l<64;l++){if(l<16)F[l]=t[r+l]|0;else{const w=F[l-15],g=(w<<25|w>>>7)^(w<<14|w>>>18)^w>>>3,b=F[l-2],v=(b<<15|b>>>17)^(b<<13|b>>>19)^b>>>10;F[l]=g+F[l-7]+v+F[l-16]}const _=i&p^~i&h,S=n&c^n&a^c&a,$=(n<<30|n>>>2)^(n<<19|n>>>13)^(n<<10|n>>>22),B=(i<<26|i>>>6)^(i<<21|i>>>11)^(i<<7|i>>>25),C=f+B+_+je[l]+F[l],R=$+S;f=h,h=p,p=i,i=u+C|0,u=a,a=c,c=n,n=C+R|0}e[0]=e[0]+n|0,e[1]=e[1]+c|0,e[2]=e[2]+a|0,e[3]=e[3]+u|0,e[4]=e[4]+i|0,e[5]=e[5]+p|0,e[6]=e[6]+h|0,e[7]=e[7]+f|0}finalize(t){super.finalize(t);const r=this._nDataBytes*8,e=this._data.sigBytes*8;return this._data.words[e>>>5]|=128<<24-e%32,this._data.words[(e+64>>>9<<4)+14]=Math.floor(r/4294967296),this._data.words[(e+64>>>9<<4)+15]=r,this._data.sigBytes=this._data.words.length*4,this._process(),this._hash}}function Ae(o){return new Fe().finalize(o).toString(Ce)}function Le(o,t={}){const r=typeof o=="string"?o:ke(o,t);return Ae(r).slice(0,10)}function Ue(...o){return`${pe}${Le([...o])}`}let T;async function Ie({accept:o="*",multiple:t=!0}={}){return T=document.createElement("input"),T.type="file",T.classList.add("sr-only"),T.value=null,T.accept=o,T.multiple=t,T.click(),new Promise(r=>{T.addEventListener("change",e=>{r([...e.target.files]),T.remove()})})}async function Me(o,{maxSize:t}={}){if(!t)return o;const r=await Oe(o);return await De(r,o.type,t)}async function Oe(o){const t=new Image,r=URL.createObjectURL(o);return t.src=r,await new Promise((e,n)=>{t.onload=()=>{e(t)},t.onerror=()=>{URL.revokeObjectURL(r),n(new Error("Failed to load the image"))}}),URL.revokeObjectURL(r),t}async function De(o,t,r){const e=document.createElement("canvas"),n=e.getContext("2d");let c=1;r&&(o.width>r||o.height>r)&&(c=r/Math.max(o.width,o.height)),e.width=o.width*c,e.height=o.height*c,n.drawImage(o,0,0,e.width,e.height);const a=await new Promise(u=>{e.toBlob(u,t)});if(!a)throw new Error("Failed to convert canvas to Blob");return a}function ze(o,t,r,e,n,c,a,u){var i=typeof o=="function"?o.options:o;t&&(i.render=t,i.staticRenderFns=r,i._compiled=!0),e&&(i.functional=!0),c&&(i._scopeId="data-v-"+c);var p;if(a?(p=function(l){l=l||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!l&&typeof __VUE_SSR_CONTEXT__<"u"&&(l=__VUE_SSR_CONTEXT__),n&&n.call(this,l),l&&l._registeredComponents&&l._registeredComponents.add(a)},i._ssrRegister=p):n&&(p=u?function(){n.call(this,(i.functional?this.parent:this).$root.$options.shadowRoot)}:n),p)if(i.functional){i._injectStyles=p;var h=i.render;i.render=function(_,S){return p.call(S),h(_,S)}}else{var f=i.beforeCreate;i.beforeCreate=f?[].concat(f,p):[p]}return{exports:o,options:i}}const Z={...ce},Ge=Object.assign({inheritAttrs:!1},{__name:"Copilot",props:Z,setup(o){const t=o,r=K(),e=N(),n=se(),c=/^<(\w+)>\s*<\/\1>$/,a=y(),u=y(),i=y(),p=y(),h=y(),f=y(),l=y(),_=y(),S=y(),$=y(!1),B=y(!1),C=y(!1),R=y(),w=y(),g=y(),b=y([]),v=y([]);let k,j;const D=V(()=>n.getters["content/values"]()),ee=V(()=>!B.value&&g.value!==void 0);W(w,m=>{$.value&&h.value&&(m&&m!==i.value?localStorage.setItem(`${k}$prompt`,m):(!m||m===i.value)&&localStorage.removeItem(`${k}$prompt`))}),W(C,m=>{$.value&&h.value&&(m?localStorage.setItem(`${k}$open`,"true"):localStorage.removeItem(`${k}$open`))}),(async()=>{const{load:m}=oe(),d=await m({parent:t.parent,name:t.name});if(a.value=te(d.label)||r.t("johannschopplich.copilot.label"),u.value=d.field??void 0,i.value=d.userPrompt??void 0,p.value=d.systemPrompt||d.config.systemPrompt||void 0,h.value=d.storage,d.editable===!0&&b.value.push("edit"),d.files===!0&&b.value.push("files"),f.value=ue.indexOf(d.config.logLevel??d.logLevel),l.value=d.supported,_.value=d.config,de(d.assets),d.files==="auto"&&d.modelFile){S.value=d.modelFile;const{mime:x,url:U}=d.modelFile;I.includes(x)&&fetch(U).then(P=>P.blob()).then(P=>{v.value=[P]})}h.value&&(k=Ue(r.view.path,u.value),w.value=localStorage.getItem(`${k}$prompt`)||i.value||"",C.value=localStorage.getItem(`${k}$open`)==="true",ie(()=>{R.value&&C.value&&(R.value.open=!0)})),r.events.on("view.save",G),$.value=!0})(),ae(()=>{r.events.off("view.save",G)});function te(m){return!m||typeof m=="string"?m:m[r.translation.code]??Object.values(m)[0]}async function He(){if(!w.value){r.notification.error(r.t("johannschopplich.copilot.prompt.empty"));return}r.isLoading=!0,B.value=!0,g.value=D.value[u.value],j=new AbortController;const{AbortError:m,ApiCallError:d}=await O("modelfusion");let x="",U=Date.now();try{const P=await xe({userPrompt:w.value,systemPrompt:p.value,context:ne(),files:v.value,config:_.value,logLevel:f.value,run:{abortSignal:j.signal}});for await(const qe of P)if(x+=qe,Array.isArray(g.value)){if(Date.now()-U<_.value.blocksUpdateThrottle)continue;U=Date.now();const re=await z(x);re.length>0&&n.dispatch("content/update",[u.value,[...g.value,...re]])}else n.dispatch("content/update",[u.value,g.value+x])}catch(P){if(j=void 0,r.isLoading=!1,B.value=!1,P instanceof m)return;if(P instanceof d){console.error(P),r.notification.error(P.message);return}console.error(P),r.notification.error(r.t("johannschopplich.copilot.generator.error"));return}n.dispatch("content/update",[u.value,Array.isArray(g.value)?[...g.value,...await z(x)]:g.value+x]),j=void 0,r.isLoading=!1,B.value=!1,r.notification.success({icon:"sparkling",message:r.t("johannschopplich.copilot.generator.success")})}function Je(){j==null||j.abort()}function Ye(){n.dispatch("content/update",[u.value,g.value]),g.value=void 0}async function Xe(){const m=await Ie({accept:[...I,"application/pdf"].join(",")});v.value=await Promise.all(m.map(async d=>d.type.startsWith("image/")?Me(d,{maxSize:2048}):d))}async function z(m){if(!m)return[];const{blocks:d}=await e.post("__copilot__/html2blocks",{html:m});return d.length===1&&"text"in d[0].content&&c.test(d[0].content.text)?[]:d}function ne(){const m={...D.value,title:r.view.title};return Object.fromEntries(Object.entries(m).map(([d,x])=>[d,Array.isArray(x)||typeof x=="object"&&x!==null?JSON.stringify(x):x]))}function G(){ee.value&&(g.value=void 0)}return{__sfc:!0,propsDefinition:Z,props:t,panel:r,api:e,store:n,EMPTY_HTML_TAG_RE:c,label:a,field:u,userPrompt:i,systemPrompt:p,storage:h,logLevel:f,supported:l,config:_,modelFile:S,isInitialized:$,isGenerating:B,isDetailsOpen:C,detailsElement:R,currentPrompt:w,currentFieldContent:g,allow:b,files:v,storageKey:k,abortController:j,currentContent:D,canUndo:ee,t:te,generate:He,abort:Je,undo:Ye,pickFiles:Xe,htmlToBlocks:z,createContext:ne,onModelSave:G,SUPPORTED_PROVIDERS:le,SUPPORTED_VISION_MIME_TYPES:I}}});var Ke=function(){var n,c,a,u,i,p,h;var t=this,r=t._self._c,e=t._self._setupProxy;return e.isInitialized?r("k-section",{attrs:{label:e.label}},[!e.config.provider||!e.SUPPORTED_PROVIDERS.includes(e.config.provider)?r("k-box",{attrs:{theme:"empty"}},[r("k-text",[t._v(" Unsupported provider "),r("code",[t._v(t._s(e.config.provider))]),t._v(" in the "),r("code",[t._v("johannschopplich.copilot.provider")]),t._v(" global configuration. ")])],1):(c=(n=e.config.providers)==null?void 0:n[e.config.provider])!=null&&c.apiKey?e.config.provider==="openai"&&!((i=(u=(a=e.config.providers)==null?void 0:a.openai)==null?void 0:u.model)!=null&&i.default)||e.config.provider==="mistral"&&!((h=(p=e.config.providers)==null?void 0:p.mistral)!=null&&h.model)?r("k-box",{attrs:{theme:"empty"}},[r("k-text",[t._v(" Missing "),r("code",[t._v(t._s(e.config.provider==="openai"?"model.default":"model"))]),t._v(" property in the "),r("code",[t._v(t._s(`johannschopplich.copilot.providers.${e.config.provider}`))]),t._v(" global configuration. ")])],1):e.field?e.field in e.currentContent?e.supported?!e.allow.includes("edit")&&!e.userPrompt?r("k-box",{attrs:{theme:"empty"}},[r("k-text",[t._v(" If the user prompt cannot be edited by the user, a default "),r("code",[t._v("userPrompt")]),t._v(" has to be set in the section configuration. ")])],1):r("div",{staticClass:"kai-space-y-4"},[r("k-button-group",{attrs:{layout:"collapsed"}},[r("k-button",{attrs:{icon:e.isGenerating?"loader":"sparkling",text:e.panel.t("johannschopplich.copilot.generate"),variant:"filled",size:"sm",theme:"positive",disabled:e.isGenerating},on:{click:function(f){return e.generate()}}}),e.isGenerating?r("k-button",{attrs:{icon:"cancel",text:e.panel.t("johannschopplich.copilot.stop"),variant:"filled",size:"sm",theme:"notice"},on:{click:function(f){return e.abort()}}}):t._e(),e.canUndo?r("k-button",{attrs:{icon:"undo",text:e.panel.t("johannschopplich.copilot.undo"),variant:"filled",size:"sm"},on:{click:function(f){return e.undo()}}}):t._e()],1),e.allow.length>0?r("details",{ref:"detailsElement",on:{toggle:function(f){e.isDetailsOpen=f.target.open}}},[r("summary",[t._v(" "+t._s([...e.allow.includes("edit")?[e.panel.t("johannschopplich.copilot.prompt.label")]:[],...e.allow.includes("files")?[e.panel.t("johannschopplich.copilot.context")]:[]].join(", "))+" ")]),r("div",{staticClass:"kai-mt-3"},[e.allow.includes("edit")?r("div",{staticClass:"kai-mb-2 kai-text-right"},[r("k-input",{key:e.isDetailsOpen?1:0,staticClass:"kai-mb-1",attrs:{placeholder:e.panel.t("johannschopplich.copilot.prompt.placeholder"),type:"textarea",buttons:!1,counter:!1},model:{value:e.currentPrompt,callback:function(f){e.currentPrompt=f},expression:"currentPrompt"}}),r("k-button",{directives:[{name:"show",rawName:"v-show",value:e.userPrompt&&e.currentPrompt!==e.userPrompt,expression:"userPrompt && currentPrompt !== userPrompt"}],attrs:{icon:"undo",text:"Reset",size:"xs",variant:"dimmed"},on:{click:function(f){e.currentPrompt=e.userPrompt}}})],1):t._e(),e.allow.includes("files")?r("k-button-group",{attrs:{layout:"collapsed"}},[r("k-button",{attrs:{icon:"upload",text:e.panel.t("johannschopplich.copilot.files.select"),variant:"filled",size:"sm"},on:{click:function(f){return e.pickFiles()}}}),e.files.length>0?r("k-button",{attrs:{icon:"cancel",text:e.panel.t("johannschopplich.copilot.remove"),variant:"filled",size:"sm"},on:{click:function(f){e.files=[]}}}):t._e()],1):e.modelFile?r("k-box",{attrs:{theme:"none"}},[r("k-text",[t._v(" "+t._s(e.panel.t(`johannschopplich.copilot.context.file.${e.SUPPORTED_VISION_MIME_TYPES.includes(e.modelFile.mime)?"model":"unsupported"}`))+" ")])],1):t._e()],1)]):t._e()],1):r("k-box",{attrs:{theme:"empty"}},[r("k-text",[t._v(" The "),r("code",[t._v(t._s(e.field))]),t._v(" field is not supported. Use a "),r("code",[t._v("blocks")]),t._v(", "),r("code",[t._v("text")]),t._v(", "),r("code",[t._v("textarea")]),t._v(" or "),r("code",[t._v("textarea")]),t._v(" type. ")])],1):r("k-box",{attrs:{theme:"empty"}},[r("k-text",[t._v(" The "),r("code",[t._v(t._s(e.field))]),t._v(" field does not exist in the current model. ")])],1):r("k-box",{attrs:{theme:"empty"}},[r("k-text",[t._v(" Missing "),r("code",[t._v("field")]),t._v(" property in the section configuration. It is required for the generated text. ")])],1):r("k-box",{attrs:{theme:"empty"}},[r("k-text",[t._v(" Missing "),r("code",[t._v("apiKey")]),t._v(" property in the "),r("code",[t._v(t._s(`johannschopplich.copilot.providers.${e.config.provider}`))]),t._v(" global configuration. ")])],1)],1):t._e()},Ne=[],Ve=ze(Ge,Ke,Ne,!1,null,null,null,null);const We=Ve.exports;window.panel.plugin("johannschopplich/copilot",{sections:{copilot:We}})})();
